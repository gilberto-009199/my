var prev_bs,tooltipCache={};function get_bs(){var t=check_bs();prev_bs!=t&&update_bs(prev_bs=t)}function check_bs(){var t=$(window).width(),t=t<760?"sm":760<=t&&t<970?"md":"lg";return t}function update_bs(t){var e,a,i;console.log("Updating bs"),"sm"==t?(e="\x3c!-- SM--\x3e<script type=\"text/javascript\">MonkeyBroker.adPlacement({sizes:['1'],el:top_slot});<\/script>",a="\x3c!-- SM--\x3e<script type=\"text/javascript\">MonkeyBroker.adPlacement({sizes:['1'],el:bottom_slot});<\/script>",i="\x3c!--SM-EMPTY--\x3e"):"md"==t?(e='\x3c!--MD--\x3e<script type="text/javascript">MonkeyBroker.adPlacement({sizes:[5],el:top_slot});<\/script>',a='\x3c!--MD--\x3e<script type="text/javascript">MonkeyBroker.adPlacement({sizes:[5],el:bottom_slot});<\/script>',i="\x3c!--MD-EMPTY--\x3e"):"lg"==t&&(e='\x3c!--LG--\x3e<script type="text/javascript">MonkeyBroker.adPlacement({sizes:[35,33,5],el:top_slot});<\/script>',a='\x3c!--LG--\x3e<script type="text/javascript">MonkeyBroker.adPlacement({sizes:[35,33,5],el:bottom_slot});<\/script>',i="\x3c!--LG--\x3e<script type=\"text/javascript\">MonkeyBroker.adPlacement({sizes:['300x600','300x250','160x600','Stacked 300x250'],el:right_slot});<\/script>"),$("#top_slot").html(e),$("#bottom_slot").html(a),$("#right_slot").html(i)}function qtip_options(){return{overwrite:!1,style:{classes:"qtip-transparent"},content:{text:function(t,i){var e=$(this).attr(i.options.content.attr);if($(this).data("ct")&&(n="comment_tip",$(this).qtip("api").set("style.classes",n)),$(this).data("id")){var a=$(this).data("id")+lang;if(tooltipCache[a])return tooltipCache[a];$.ajax({url:"/tip.php",type:"GET",data:{id:$(this).data("id"),grade:$(this).data("grade"),enchant:$(this).data("enchant"),pos:$(this).data("pos"),l:lang,nf:"on"}}).then(function(t){tooltipCache[a]=t,i.set("content.text",t)},function(t,e,a){i.set("content.text",e+": "+a)}),e=e?e+" (Loading...)":"Loading..."}else{var n="qtip-bootstrap";$(this).qtip("api").set("style.classes",n),$(this).qtip("api").set("position.adjust.x",12),$(this).qtip("api").set("position.adjust.y",12),$(this).qtip("api").set("style.tip.corner",!1)}return e}},position:{target:"mouse",effect:!1,adjust:{method:"shift",x:5,y:5},viewport:$(window)}}}function get_datatable(t,e,a,i,n){var s=$("#"+t).DataTable({ajax:e,columns:JSON.parse(a),order:JSON.parse(n),scrollCollapse:!0,deferRender:!0,responsive:!0,stateSave:!1,dom:'<<"inlinediv column_select_button"B><"inlinediv"l><"inlinediv pull-right"f>><<"inlinediv"i><"inlinediv pull-right"p>>rt<<"inlinediv"l><"inlinediv pull-right"f>><<"inlinediv"i><"inlinediv pull-right"p>>',buttons:["colvis"],language:{url:"/lang/datatables_"+lang+".txt",buttons:{colvis:colvis}},rowCallback:function(t,e,a){customFnRowCallback(t,e,a,i)},searchDelay:350}).on("mouseenter","[data-id]",function(t){$(this).qtip($.extend(!0,qtip_options(),{show:{ready:!0}}),t)});$.fn.dataTable.util.throttle(function(t){s.draw()},300);$(".dt_qfilter").keyup(function(){s.draw()}),$(".dt_qfilter").change(function(){s.draw()})}function customFnRowCallback(i,n,t,e){return $.each(JSON.parse(e),function(t,e){var a;""===n[e]||null!=(a=$("td:eq("+e+")",i).html())&&(a=(a=a.replace(/\[/g,"<")).replace(/\]/g,">"),$("td:eq("+e+")",i).html(a))}),i}function linktip(){$("head").append('<link rel="stylesheet" type="text/css" href="http://bd.localhost/css/bddatabase.min.css">'),$('a[href^="http://bddatabase.net/"]').each(function(){var t=this.pathname.replace(/(^\/|\/$)/g,"").split("/");3<=$(t).size()&&("item"!=t[1]&&"npc"!=t[1]&&"quest"!=t[1]&&"recipe"!=t[1]&&"design"!=t[1]&&"title"!=t[1]&&"theme"!=t[1]&&"skill"!=t[1]&&"buff"!=t[1]&&"itemset"!=t[1]&&"sskill"!=t[1]&&"guildquest"!=t[1]&&"house"!=t[1]||("quest"==t[1]&&3 in t?($(this).attr("data-id",t[1]+"--"+t[3].replace(/[^0-9]/,"")),$(this).attr("data-quest_group",t[2].replace(/[^0-9]/,""))):$(this).attr("data-id",t[1]+"--"+t[2].replace(/[^0-9]/,"")),$(this).qtip(qtip_bddb())))})}function qtip_bddb(){return{overwrite:!1,style:{classes:"qtip-transparent"},content:{text:function(t,i){var e=$(this).attr(i.options.content.attr);if($(this).data("ct")&&(n="comment_tip",$(this).qtip("api").set("style.classes",n)),$(this).data("id")){var a=$(this).data("id")+$(this).data("quest_group")+lang;if(tooltipCache[a])return tooltipCache[a];$.ajax({url:"http://bd.localhost/tip.php",type:"GET",data:{id:$(this).data("id"),quest_group:$(this).data("quest_group"),grade:$(this).data("grade"),enchant:$(this).data("enchant"),l:lang,nf:"on"}}).then(function(t){t=(tooltipCache[a]=t).replace(/<img src=\"\//g,'<img src="http://bd.localhost/'),i.set("content.text",'<div class="bddatabase">'+t+"</div>")},function(t,e,a){i.set("content.text",e+": "+a)}),e=e?e+" (Loading...)":"Loading..."}else{var n="qtip-bootstrap";$(this).qtip("api").set("style.classes",n),$(this).qtip("api").set("position.adjust.x",12),$(this).qtip("api").set("position.adjust.y",12),$(this).qtip("api").set("style.tip.corner",!1)}return e}},position:{target:"mouse",effect:!1,adjust:{method:"shift",x:5,y:5},viewport:$(window)}}}function add_price_handler(){$(".material_price").each(function(){$(this).unbind("keyup"),$(this).keyup(function(){var t=$(this).val().replace(",","."),e=$(this).data("item_id"),a=$(this);delay(function(){save_price(e,t),$(a).attr("data-price",t),update_total_price()},500)})}),$(".check_rid").each(function(){$(this).unbind("change"),$(this).change(function(){$(this).prop("checked")||$(this).parent().siblings().find(".check_rid").prop("checked",!1),update_lp_price(),update_total_price()})})}function calculate_price(t){var e=$(t).parent().parent().parent().parent().children(".counter_value").text();null!=e&&0<e.length&&(0!=(e=e*$(t).attr("data-price"))&&(e=+(t=$("#total_price")).attr("data-price")+e,t.attr("data-price",e),e=t.attr("data-price"),$(t).text($.number(e,4))))}function calculate_price_old(t){var e,a=$(t).parent().parent().parent().children(".counter_value").html();null!=a&&0<a.length&&(e=a*$(t).attr("data-price")*$(t).attr("data-mul"),$(t).attr("data-total_price",e),(a=$("#total_price_gold")).attr("data-price",+a.attr("data-price")+e),e=(t=a.attr("data-price"))%100,$("#total_price_bronze").val(e),e=(t%1e4-t%100)/100,$("#total_price_silver").val(e),t=(t-t%1e4)/1e4,$(a).val(t))}function get_sub_materials(t,e,a,i,n){$.ajax({url:"/ajax.php",dataType:"json",type:"GET",data:{a:"sub_material",recipe_id:t,recipe_name:e,lp:a,pid:i,l:lang}}).then(function(t){1==t.result&&($(n).html(t.data),$(n).children(".content").toggle(),set_toggle_event(),add_price_handler())},function(t,e,a){alert("STATUS: "+e+" ERROR: "+a)})}function set_toggle_event(){$(".toggle-image").each(function(){$(this).unbind("click"),$(this).click(function(){$(this).siblings(".content").toggle(),$(this).toggleClass("toggle-open"),$(this).siblings().each(function(){var t,e,a,i;$(this).html().length<5&&(t=$(this).data("id"),e=$(this).data("name"),a=$(this).data("lp"),i=$(this).data("pid"),t&&get_sub_materials(t,e,a,i,$(this)))}),$(this).siblings(".sub_materials").toggle()})}),$(".qtooltip").each(function(){$(this).qtip(qtip_options())}),$("#craft_counter").keyup()}function get_price(t){var e=$(t).first().parent(),t=e.data("item_id"),a=0;e.children("input").each(function(){a+=$(this).val()*$(this).data("mul")}),0<a&&save_price(t,a)}function save_price(t,e){$.post("/ajax.php",{a:1,item_id:t,item_price:e,l:lang}).done(function(t){1==(t=JSON.parse(t)).result&&console.log("Price saved!")})}function update_lp_price(){var t=$("#craft_level").val(),e=$("#lp_counter"),a=0;$(".check_rid").each(function(){var t;$(this).prop("checked")&&(t=+$(this).parent().parent().parent().parent().children(".counter_value").html(),a+=$(this).data("lp")*t)}),e.text((e.data("base")+a)*((100-t)/100)*$("#craft_counter").val());e=$("#craft_level :selected").data("time"),t=$("#time_counter"),e=t.data("base")*$("#craft_counter").val()*((100-e)/100);t.text(format_time(1e3*e))}function save_craft_level(t,e){$.post("/ajax.php",{a:2,craft_type:t,level:e,l:lang}).done(function(t){})}$(document).ready(function(){$("#comment_text").markItUp(mySettings),$("#emoticons a").click(function(){return emoticon=$(this).attr("title"),$.markItUp({replaceWith:emoticon}),!1}),$("#craft_level").change(function(){update_lp_price(),save_craft_level($("#craft_level").data("craft_type"),$("#craft_level :selected").data("level"))}),$("#sell_price").on("keyup",function(){var t=($(this).val()-$("#total_price").attr("data-price"))/$("#lp_counter").text()*1;$("#lp_price").text($.number(t,4))}),$("#dialoglink").click(function(){$("#loginblock").dialog({dialogClass:"login",height:190,width:270,modal:!0})}),window.addEventListener("resize",check_width),$(".news_archive").on("click",function(){$(".old_news").toggle("fast")}),$(".selectall").on("click",function(){$(this).select()}),$(".toggle-image").click(function(){return $(this).siblings(".content").toggle(),$(this).toggleClass("toggle-open"),!1}),$(".toggle_text").click(function(){$(this).next("span").toggle()}),$(".qtooltip").each(function(){$(this).qtip(qtip_options())}),$(".copy").on("click",function(){clipboard.copy($("#"+$(this).data("cid")).val())}),$(".save_price_button").on("click",function(){get_price(this)});var t=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:"/ac.php?l="+lang+"&term=%QUERY",wildcard:"%QUERY"},limit:1/0});t.initialize(),$(".typeahead").typeahead({hint:!0,highlight:!0,minLength:3},{name:"matched-links",displayKey:"name",limit:1/0,source:t.ttAdapter(),templates:{empty:null,suggestion:Handlebars.compile('<p><a href="{{link}}" class="qtooltip" data-id="{{link_type}}--{{value}}"><img src="/{{icon_path}}/{{icon}}" class="image-text" alt="icon" width="30px" height="30px"> <span class="item_grade_1">{{name}}</span></a></p>')}}),$(".typeahead").bind("typeahead:render",function(t,e,a,i){$(".tt-suggestion .qtooltip ").each(function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||$(this).qtip(qtip_options())})}),$(".typeahead").on("typeahead:selected",function(t,e){window.open(e.link)}),$(".sidebar_unit").affix({offset:{top:50}}),add_price_handler(),$("#craft_counter").keyup(function(){var i=$(this).val();$(".counter_value").each(function(){var t=$(this).parent().parent().parent().parent().children(".counter_value").html(),e=$(this).data("material"),a=$(this).data("product");$(this).text(e*i),null!=t&&0<t.length&&(a=Math.ceil(t/a),$(this).text(e*a))}),update_total_price(),update_lp_price()}),set_toggle_event()}),$.fn.dataTable.ext.search.push(function(t,e,a){if($("#"+t.sTableId+"_min").length&&$("#"+t.sTableId+"_max").length){var i=$("#"+t.sTableId+"_min").val(),n=$("#"+t.sTableId+"_max").val(),t=$("#"+t.sTableId+"_min").data("col"),t="-"==e[t]?0:+e[t];return""==i&&""==n?!0:""==i&&t<=n||(i<=t&&""==n||i<=t&&t<=n)}return!0}),$.fn.dataTable.ext.search.push(function(t,e,a){if($("#"+t.sTableId+"_equipment_filters").length){var i=!0,n=e[$("#"+t.sTableId+"_str").data("col")],s=e[$("#"+t.sTableId+"_dex").data("col")],l=e[$("#"+t.sTableId+"_sta").data("col")],c=e[$("#"+t.sTableId+"_int").data("col")],o=e[$("#"+t.sTableId+"_spi").data("col")],r=e[$("#"+t.sTableId+"_use").data("col")],e=e[$("#"+t.sTableId+"_effect").data("col")];return $("#"+t.sTableId+"_str").length&&$("#"+t.sTableId+"_str").is(":checked")&&n<1&&(i=!1),$("#"+t.sTableId+"_dex").length&&$("#"+t.sTableId+"_dex").is(":checked")&&s<1&&(i=!1),$("#"+t.sTableId+"_sta").length&&$("#"+t.sTableId+"_sta").is(":checked")&&l<1&&(i=!1),$("#"+t.sTableId+"_int").length&&$("#"+t.sTableId+"_int").is(":checked")&&c<1&&(i=!1),$("#"+t.sTableId+"_spi").length&&$("#"+t.sTableId+"_spi").is(":checked")&&o<1&&(i=!1),$("#"+t.sTableId+"_use").length&&$("#"+t.sTableId+"_use").is(":checked")&&"+"!=r&&(i=!1),$("#"+t.sTableId+"_effect").length&&$("#"+t.sTableId+"_effect").is(":checked")&&"+"!=e&&(i=!1),i}return!0});var delay=function(){var a=0;return function(t,e){clearTimeout(a),a=setTimeout(t,e)}}();function update_total_price(){$("#total_price").text(0).attr("data-price",0),$(".material_price").each(function(){var t=$(this).data("item_id"),e=!1,a=$('.check_rid[data-pid="'+t+'"]');a.each(function(){a.prop("checked")&&(e=!0)}),e||(t=$(this).data("rid"),0<(t=$('.check_rid[data-rid="'+t+'"]')).length&&!t.prop("checked")||calculate_price(this))})}function format_time(t){if(t<=0)return"--";var e,a="",i=0,n=0,s=0;return 864e5<=t?(e=Math.floor(t/864e5),i=Math.floor((t-864e5*e)/36e5),n=Math.floor((t-864e5*e-36e5*i)/6e4),s=Math.floor(t-864e5*e-36e5*i-6e4*n),a=e+day_msg,0!=i&&(a+=" "+i+hour_msg),0!=n&&(a+=" "+n+minute_msg),0!=s&&(a+=" "+$.number(s/1e3,2)+second_msg)):36e5<=t?(i=Math.floor(t/36e5),n=Math.floor((t-36e5*i)/6e4),s=Math.floor(t-36e5*i-6e4*n),a=i+hour,0!=n&&(a+=" "+n+minute_msg),0!=s&&(a+=" "+$.number(s/1e3,2)+second_msg)):6e4<=t?(i=Math.floor(t/36e5),n=Math.floor((t-36e5*i)/6e4),s=Math.floor(t-36e5*i-6e4*n),a=n+minute_msg,0!=s&&(a+=" "+$.number(s/1e3,2)+second_msg)):a=0==t?0:(s=t,$.number(s/1e3,2)+second_msg),a}function set_stat_value(t,e){$("#"+t).html(e)}function cut_number(t,e){var a=String(t).indexOf(".");return 0<a&&(t=0<e?String(t).substr(0,a+e+1):String(t).substr(0,a)),t}function number_format(t,e){return null==e&&(e=","),t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,e)}function add_v(){var t=/android|ipad|iphone|ipod|samsung/i.test(navigator.userAgent),e=t?"5f0497e27474763e146528d5":"5c6d670a46e0fb000197d0a8";t?(console.log(": Mobile"),$("#adtag_top").html('<div class="vm-placement mobile_tag" data-id="'+e+'"></div>'),$("#adtag_middle").html('<div class="vm-placement" data-id="'+e+'"></div>')):(console.log(": Desktop"),$("#adtag_top").html('<div class="vm-placement" data-id="'+e+'" data-display-type="hybrid-banner"></div>'),$("#adtag_middle").html('<div class="vm-placement" data-id="5c6d670a46e0fb000197d0a8"></div>')),$("#adtag_bottom").html('<div class="vm-placement" data-id="'+e+'"></div>'),check_width()}function check_width(){window.innerWidth}