var sb_sas=[];function calc_setup(){$("#total_points").html(total_skill_points),$("#level_counter").keyup(function(){var s=$(this).val();0<(max_level=s)&&skill_array.levels[s]&&(reset_spec_points(0),reset_spec_points(1),reset_spec_points(2),total_skill_points=skill_array.levels[s]+1,$("#total_points").html(total_skill_points))}),$(".skill_reset").on("click",function(){var s=$(this).data("spec_id");reset_spec(s),add_skillset_handlers(skill_array,s),toggle_buttons(s),init_combos()}),$(".reset_spec_points").on("click",function(){reset_spec_points($(this).data("spec_id"))}),$("#class_header, .close_tag").on("click",function(){$("#class_list").toggle("clip")}),$(".generate_link_button").on("click",function(){generate_link(action,language,no_skill_msg)}),print_dial(),print_spec_ancestral_skills(0),$(".ancestral_reset").on("click",function(){reset_ancestrals()})}function generate_link(s,l,a){var t="",i="",e="";0<=$("#spec0").data("selected_set")&&(t=$("#spec0").data("selected_set")),0<=$("#spec1").data("selected_set")&&(i=$("#spec1").data("selected_set")),0<=$("#spec2").data("selected_set")&&(e=$("#spec2").data("selected_set"));var _=["0-"+t,"1-"+i,"2-"+e],c=0;$(".skill_icon").each(function(){var s;1==$(this).data("state")&&(c=1,s=$(this).data("id").split("--"),_[$(this).data("spec_id")]+="|"+s[1])}),1==c||0<sb_sas.length?(e=$("#level_counter").val(),$.ajax({url:"/sl.php",dataType:"json",type:"POST",data:{data:_[0]+"_"+_[1]+"_"+_[2],sas:sb_sas,a:s,l:l,lv:e}}).then(function(s){1===s.result?($("#permalink").val(s.message),$("#permalink_holder").show("clip").delay(6e4).hide("clip")):void 0!==s.message&&alert(s.message)},function(s,l,a){alert("ERROR: "+a)})):$("#permalink_warning").show("clip").delay(3e3).hide("clip")}function set_level(s){max_level=s,total_skill_points=skill_array.levels[max_level]+1,$("#total_points").html(total_skill_points),$("#level_counter").val(max_level)}function init_combos(){$("#combos").empty(),combo_array2=[],check_combo(),$(".combo_skill_icon").each(function(){$(this).qtip(qtip_options()),$(this).on("click",function(){var s=$(this).data("combo-id");$('[data-skill-id="'+s+'"]').each(function(){$(this).click()})})})}function toggle_buttons(s){$("#rsp"+s).toggle(),$("#sr"+s).toggle()}function enable_buttons(s){$("#rsp"+s).show(),$("#sr"+s).show()}function reset_all(){reset_spec(0),reset_spec(1),reset_spec(2),add_skillset_handlers(skill_array,0),add_skillset_handlers(skill_array,1),add_skillset_handlers(skill_array,2),toggle_buttons(0),toggle_buttons(1),toggle_buttons(2)}function reset_spec_points(s){$(".skill_icon").each(function(){$(this).data("spec_id")==s&&1==$(this).data("state")&&$(this).trigger("click")})}function reset_spec(s){selected_specs[s]=-1;var l,a="";for(l in a+='<div class="btn-group-vertical stretch" role="group">',skill_array.skillsets)a+='<button data-set_id="'+l+'" class="btn btn-default btn-block skillset spec'+s+'_skillset">'+skill_array.skillsets[l]+"</button>";a+="</div>",$("#spec"+s).html(a),$("#spec"+s+"_header").html(select_spec),$("#spec"+s+"_header").addClass("middletext"),used_skill_points-=spec_points[s],$("#total_points").html(total_skill_points-used_skill_points),$("#spec"+s+"_points").html("");for(var t=spec_points[s]=0;t<3;t++)t!=s&&$(".spec"+t+"_skillset").each(function(){$(this).show()});$("#spec"+s).data("selected_set","-1");for(var i=0;i<3;i++){var e=$("#spec"+i).data("selected_set");if(0<=e)for(t=0;t<3;t++)$(".spec"+t+"_skillset").each(function(){$(this).data("set_id")==e&&$(this).hide()})}$("#skill_class").html(""),$("#permalink_holder").hide()}function change_class(){for(var s="",l=[-1,-1,-1],a=0;a<3;a++)s+=$("#spec"+a).data("selected_set"),l[a]=$("#spec"+a).data("selected_set");l.sort(function(s,l){return s-l}),s="[";var t,i,e="";for(t in l)s+=e+l[t],""==e&&(e=",");for(i in s+="]",skill_array.specs)skill_array.specs[i].id==s?$("#skill_class").html(skill_array.specs[i].name):$("#skill_class").html()}function check_hash(s){if(""==s&&(s=window.location.hash),0<s.length)if("!"==s[1]){var l,a=s.replace("#!","").split("-");for(l in a)$(".btn.skillset.spec"+l+'_skillset[data-set_id="'+a[l]+'"]').click()}else $.get("/sl.php",{id:s}).done(function(s){var l,a=s.split("_");for(l in""!=a[3]&&set_level(a[3].replace(/[^0-9]/i,"")),a){var t,i,e,_=a[l].split("!"),c=_[0].split("|");for(t in void 0!==_[1]&&(_=_[1].replace(/[^0-9,]/i,""),sb_sas=JSON.parse("["+_+"]")),c)0==t?""!=(i=c[t].split("-"))[1]&&(set_skillset(i[0],i[1]),selected_specs[i[0]]=i[1],init_combos()):(e=c[t],$(".skill_icon").each(function(){$(this).data("id").split("--")[1]==e&&$(this).trigger("click")}))}update_selected_ancestrals()})}function set_skillset(s,l){selected_specs[s]=l,$("#spec"+s).data("selected_set",l),change_class();for(var a=0;a<3;a++)a!=s&&$(".spec"+a+"_skillset").each(function(){$(this).data("set_id")==l&&$(this).hide()});var t,i=0,e="";for(t in skill_array["active_skills"+l]){i++,sep="";var _=skill_array["active_skills"+l][t].id,c=skill_array["active_skills"+l][t].icon,r=skill_array["active_skills"+l][t].cost,o=skill_array["active_skills"+l][t].level,n="skill_overlay";0<(k=skill_array["active_skills"+l][t].req)?e+='<div class="iconset_wrapper_big skill_square"><div class="icon_wrapper"><img src="/items/'+c+'" alt="icon" class="list_icon_big"></div><div class="qtooltip '+(n="passive_overlay"+k)+' skill_icon" data-id="skill--'+_+'" data-skill-id="'+_+'" data-spec_id="'+s+'" data-req_p="'+k+'" data-req_l="'+o+'" data-cost="'+r+'" data-state="0"></div></div>'+sep:0==r?sep:e+='<div class="iconset_wrapper_big skill_square"><div class="icon_wrapper"><img src="/items/'+c+'" alt="icon" class="list_icon_big"></div><div class="qtooltip skill_overlay skill_icon" data-id="skill--'+_+'" data-skill-id="'+_+'" data-spec_id="'+s+'" data-req_p="'+k+'" data-req_l="'+o+'" data-cost="'+r+'" data-state="0"></div></div>'+sep}var d,p="";for(d in skill_array["passive_skills"+l]){i++;var k,_=skill_array["passive_skills"+l][d].id,c=skill_array["passive_skills"+l][d].icon,n="skill_overlay";0<(k=skill_array["passive_skills"+l][d].req)?p+='<div class="iconset_wrapper_big passive_skill_square"><div class="icon_wrapper qtooltip" data-id="buff--'+_+'"><img src="/items/'+c+'" alt="icon" class="list_icon_big"></div><div class="qtooltip '+(n="passive_overlay"+k)+' skill_icon cursor_normal" data-spec_id="'+s+'" data-cost="1" data-req_p="'+k+'" data-req_l="1" data-id="buff--'+_+'" data-state="0"></div></div>':0}spec_total_points[s]=i,$("#spec"+s+"_header").html(skill_array.skillsets[l]),$("#spec"+s+"_header").removeClass("middletext"),$("#spec"+s+"_points").html(spec_points[s]+"/"+spec_total_points[s]),$("#spec"+s).html('<div class="skill_holder"><div class="active_skills"><span class="active_skill_tag">'+active+"</span><br>"+e+'</div><div class="passive_skills"><span class="passive_skill_tag">'+passive+"</span><br>"+p+"</div></div>"),$(".active_skills .skill_icon").each(function(){var s=$(this).data("skill-id"),l=$(this).parent().parent().parent().parent().data("id"),a=$(this).data("cost");$(this).off("click"),$(this).on("click",function(){0==$(this).attr("data-state")?(used_skill_points<total_skill_points||0==a)&&$(this).data("req_p")<=spec_points[l]&&$(this).data("req_l")<=$("#level_counter").val()&&(spec_points[l]+=a,$("#spec"+l+"_points").html(spec_points[l]+"/"+spec_total_points[l]),$(this).attr("data-state",1),used_skill_points+=a,$("#total_points").html(total_skill_points-used_skill_points),0<$(this).data("req_p")?$(this).toggleClass("passive_overlay"+$(this).data("req_p")):$(this).toggleClass("skill_overlay"),$(this).toggleClass("skill_frame"),$('[data-combo-id="'+s+'"]').each(function(){$(this).toggleClass("skill_overlay"),$(this).toggleClass("skill_frame")})):(0<used_skill_points||0==a)&&(spec_points[l]-=a,$("#spec"+l+"_points").html(spec_points[l]+"/"+spec_total_points[l]),$(this).attr("data-state",0),used_skill_points-=a,$("#total_points").html(total_skill_points-used_skill_points),0<$(this).data("req_p")?$(this).toggleClass("passive_overlay"+$(this).data("req_p")):$(this).toggleClass("skill_overlay"),$(this).toggleClass("skill_frame"),$('[data-combo-id="'+s+'"]').each(function(){$(this).toggleClass("skill_overlay"),$(this).toggleClass("skill_frame")})),update_passsive_skills(l)})}),$(".qtooltip").each(function(){$(this).qtip(qtip_options())}),toggle_buttons(s)}function update_passsive_skills(s){var l=$("#spec"+s+' .skill_icon[data-state="1"]').length;$("#spec"+s+' .passive_skills .skill_icon[data-state="0"]').each(function(){$(this).data("req_p")<=l?$(this).removeClass("passive_overlay"+$(this).data("req_p")):$(this).addClass("passive_overlay"+$(this).data("req_p"))})}var delay=function(){var a=0;return function(s,l){clearTimeout(a),a=setTimeout(s,l)}}();function add_skillset_handlers(s,l){$(".spec"+l+"_skillset").on("click",function(){var s=$(this).data("set_id");set_skillset(l,s),delay(function(){init_combos()},1e3)})}function check_combo(){for(var s=total_combos=0;s<3;s++)if(-1!=selected_specs[s]){var l,a=selected_specs[s];for(l in skill_array["active_skills"+a])for(var t in combo_x=0,skill_array["active_skills"+a][l].buffs){var i=new Array;i.push(skill_array["active_skills"+a][l].id);var e=skill_array["active_skills"+a][l].id,_=skill_array["active_skills"+a][l].icon,c=skill_array["active_skills"+a][l].cost,r=skill_array["active_skills"+a][l].level,o="skill_overlay";$('[data-skill-id="'+e+'"]').each(function(){$(this).hasClass("skill_frame")&&(o="skill_frame")});c={parent_id:"-1",skill_id:e,skill_text:'<div class="iconset_wrapper_big skill_square"><div class="icon_wrapper"><img src="/items/'+_+'" alt="icon" class="list_icon_big"></div><div class="qtooltip '+o+' combo_skill_icon" data-id="skill--'+e+'" data-combo-id="'+e+'" data-req_p="0" data-req_l="'+r+'" data-cost="'+c+'" data-state="0"></div></div>'},c=combo_array2.push(c)-1;check_skill_combo2(a,l,skill_array["active_skills"+a][l].buffs[t],i,1,c)}}var n=print_combo_array3(-1,"","");$("#combos").empty(),$("#combos").append('<tr><td class="center_text"><table class="combo_table">'+n+"</table></td></tr>"),$("#combo_counter").html(total_combos),$(".qtooltip").each(function(){$(this).qtip(qtip_options())})}function check_skill_combo2(s,l,a,t,i,e){var _=skill_array["active_skills"+s][l].id,l=(skill_array["active_skills"+s][l].icon,skill_array["active_skills"+s][l].cost,skill_array["active_skills"+s][l].level),c="skill_overlay";$('[data-skill-id="'+_+'"]').each(function(){$(this).hasClass("skill_frame")&&(c="skill_frame")});for(var r=0;r<3;r++)if(-1<selected_specs[r]){var o,n=selected_specs[r];for(o in skill_array["active_skills"+n])if(1==i&&(t=new Array).push(_),-1==t.indexOf(skill_array["active_skills"+n][o].id))for(var d in skill_array["active_skills"+n][o].combo)if(skill_array["active_skills"+n][o].combo[d]==a){var p=skill_array["active_skills"+n][o].id,k=skill_array["active_skills"+n][o].icon,v=skill_array["active_skills"+n][o].cost,h=skill_array["active_skills"+n][o].level,c="skill_overlay";$('[data-skill-id="'+p+'"]').each(function(){$(this).hasClass("skill_frame")&&(c="skill_frame")});var m,v={parent_id:e,combo_text:skill_array["active_skills"+n][o].combo_descs[d],skill_id:p,skill_text:'<img src="/items/'+skill_array["active_skills"+n][o].combo_icons[d]+'" alt="icon" width="20px" height="20px" class="image-text qtooltip" title=\''+skill_array["active_skills"+n][o].combo_descs[d]+'\'> <div class="iconset_wrapper_big skill_square"><div class="icon_wrapper"><img src="/items/'+k+'" alt="icon" class="list_icon_big"></div><div class="qtooltip '+c+' combo_skill_icon" data-id="skill--'+p+'" data-combo-id="'+p+'" data-req_p="0" data-req_l="'+h+'" data-cost="'+v+'" data-state="0"></div></div>'},f=combo_array2.push(v)-1;for(m in t.push(skill_array["active_skills"+n][o].id),skill_array["active_skills"+n][o].buffs)check_skill_combo2(n,o,skill_array["active_skills"+n][o].buffs[m],t,0,f);0<skill_array["active_skills"+n][o].combo_result[d]&&check_skill_combo2(n,o,skill_array["active_skills"+n][o].combo_result[d],t,0,f)}}}function print_combo_array3(s,l,a){var t,i,e,_,c="";for(t in combo_array2)combo_array2[t].parent_id==s&&(i=l+combo_array2[t].skill_text,(e="")!=combo_array2[t].combo_text&&void 0!==combo_array2[t].combo_text&&(e=a+" "+combo_array2[t].combo_text+"<br>"),_=print_combo_array3(t,i,e),-1==s&&""==_||(""==_?(total_combos++,c+='<tr><td class="combo_number">'+total_combos+'</td><td class="combo_column">'+i+"</td>",""!=e&&(c+='<td class="combo_description"><span class="">'+e+"</span></td>"),c+="</tr>"):c+=_));return c}function print_dial(){if(saved=!1,"undefined"!=typeof skill_array){var s,l="";for(s in skill_array.skillsets)l+='<button class="btn btn-default btn-sm stretch aspec_button" data-spec_id="'+s+'">'+skill_array.skillsets[s]+"</button>";$(".skillsets_list").html(l),$(".aspec_button").each(function(){$(this).on("click",function(){reset_dial();var s=+$(this).data("spec_id");print_spec_ancestral_skills(s),$(".spec_row").text(skill_array.skillsets[s])})});for(var a=$(".ancestral_dial"),t=1;t<12;t++)t%3==0&&t++,$(a).append('<div class="ancestral_effect effect_pos_'+t+'"><img src="/images/skillbuilder/icon_'+t+'_0.png" id="ancestral_effect_'+t+'" alt="effect"></div>'),$(a).append('<div class="ancestral_slot slot_pos_'+t+'"><img src="/images/skillbuilder/ancestral_slot.png" alt="slot"><div class="ancestral_slot_icon" id="ancestral_icon_'+t+'" data-state="0"></div></div>');$(a).append('<div class="ancestral_slot_center"><img src="/images/skillbuilder/ancestral_slot_1.png" alt="center_slot"><div class="ancestral_slot_icon" id="ancestral_icon_center" data-state="0"></div></div>')}}function reset_dial(){saved=!1;for(var s=1;s<12;s++)s%3==0&&s++,$("#ancestral_effect_"+s).attr("src","/images/skillbuilder/icon_"+s+"_0.png"),$("#ancestral_icon_"+s).html(""),$("#ancestral_icon_center").html("")}function print_spec_ancestral_skills(a){if("undefined"!=typeof skill_array){var s,l=$(".skills_row"),t="";for(s in skill_array.as[a])t+='<div class="ancestrall_skill pointer" data-id="skill--'+skill_array.as[a][s][0]+'" data-skill_id="'+skill_array.as[a][s][0]+'" data-pos="'+s+'"><img src="/items/'+skill_array.as[a][s][1]+'" class="ancestrall_skill_icon" alt="icon"></div>';$(l).html(t),$(".ancestrall_skill").each(function(){$(this).qtip(qtip_options()).on("click",function(){saved=!1,reset_dial();var s=+$(this).data("skill_id"),l=+$(this).data("pos");select_ancestral_skill(a,s,l)})})}}function select_ancestral_skill(s,l,a){for(var t in $("#ancestral_icon_center").html('<img src="/items/'+skill_array.as[s][a][1]+'" class="ancestrall_skill_icon_center" data-id="skill--'+l+'" alt="icon">'),$(".ancestrall_skill_icon_center").qtip(qtip_options()),$(".spec_row").text(skill_array.skillsets[s]+">"+skill_array.as[s][a][2]),skill_array.asv[l]){var i="",e=0;-1<$.inArray(skill_array.asv[l][t][0],sb_sas)&&(i=" ancestral_selected",e=1),$("#ancestral_effect_"+t).attr("src","/images/skillbuilder/icon_"+t+"_1.png"),$("#ancestral_icon_"+t).html('<img src="/items/'+skill_array.asv[l][t][1]+'" class="ancestrall_skill_icon slot_icon pointer'+i+'" data-id="skill--'+skill_array.asv[l][t][0]+'" data-skill_id="'+skill_array.asv[l][t][0]+'" data-state="'+e+'" alt="icon">')}$(".slot_icon").each(function(){$(this).qtip(qtip_options()).on("click",function(){saved=!1;var s=+$(this).attr("state");s^=1,$(this).attr("state",s).toggleClass("ancestral_selected");var l=+$(this).data("skill_id");$(this).data("pos"),$(this).attr("src");1==s?(sb_sas.push(l),update_selected_ancestrals()):(-1<(s=$.inArray(l,sb_sas))&&sb_sas.splice(s,1),$("#aas"+l).remove()),$(".slot_icon[data-skill_id!="+l+"]").each(function(){$(this).attr("state",0).removeClass("ancestral_selected");var s=+$(this).data("skill_id"),s=$.inArray(s,sb_sas);-1<s&&(sb_sas.splice(s,1),update_selected_ancestrals())})})})}function reset_ancestrals(){sb_sas=[],reset_dial(),update_selected_ancestrals()}function update_selected_ancestrals(){var s,l="";for(s in sb_sas)l+='<div class="ancestrall_skill" data-id="skill--'+sb_sas[s]+'"><img src="/items/'+skill_array.av[sb_sas[s]]+'" class="ancestrall_skill_icon" alt="icon"></div>';$(".activated_skills_row").html(l),$(".activated_skills_row .ancestrall_skill").qtip(qtip_options())}