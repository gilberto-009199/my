/*!
 * jQuery Upload File Plugin
 * version: 3.1.8
 * @requires jQuery v1.5 or later & form plugin
 * Copyright (c) 2013 Ravishanker Kusuma
 * http://hayageek.com/
 */
(function(b){if(b.fn.ajaxForm==undefined){b.getScript("http://malsup.github.io/jquery.form.js")}var a={};a.fileapi=b("<input type='file'/>").get(0).files!==undefined;a.formdata=window.FormData!==undefined;b.fn.uploadFile=function(z){function J(){if(t.afterUploadAll&&!k){k=true;(function c(){if(q.sCounter!=0&&q.sCounter+q.fCounter==q.tCounter){t.afterUploadAll(q);k=false}else{window.setTimeout(c,100)}})()}}function F(c,f,d){d.on("dragenter",function(g){g.stopPropagation();g.preventDefault();b(this).css("border","2px solid #A5A5C7")});d.on("dragover",function(g){g.stopPropagation();g.preventDefault()});d.on("drop",function(h){b(this).css("border","2px dotted #A5A5C7");h.preventDefault();c.errorLog.html("");var g=h.originalEvent.dataTransfer.files;if(!f.multiple&&g.length>1){if(f.showError){b("<div style='color:red;'>"+f.multiDragErrorStr+"</div>").appendTo(c.errorLog)}return}if(f.onSelect(g)==false){return}D(f,c,g)});b(document).on("dragenter",function(g){g.stopPropagation();g.preventDefault()});b(document).on("dragover",function(g){g.stopPropagation();g.preventDefault();d.css("border","2px dotted #A5A5C7")});b(document).on("drop",function(g){g.stopPropagation();g.preventDefault();d.css("border","2px dotted #A5A5C7")})}function B(f){var c="";var g=f/1024;if(parseInt(g)>1024){var d=g/1024;c=d.toFixed(2)+" MB"}else{c=g.toFixed(2)+" KB"}return c}function H(d){var l=[];if(jQuery.type(d)=="string"){l=d.split("&")}else{l=b.param(d).split("&")}var g=l.length;var c=[];var f,h;for(f=0;f<g;f++){l[f]=l[f].replace(/\+/g," ");h=l[f].split("=");c.push([decodeURIComponent(h[0]),decodeURIComponent(h[1])])}return c}function D(R,l,c){for(var y=0;y<c.length;y++){if(!w(l,R,c[y].name)){if(R.showError){b("<div style='color:red;'><b>"+c[y].name+"</b> "+R.extErrorStr+R.allowedTypes+"</div>").appendTo(l.errorLog)}continue}if(R.maxFileSize!=-1&&c[y].size>R.maxFileSize){if(R.showError){b("<div style='color:red;'><b>"+c[y].name+"</b> "+R.sizeErrorStr+B(R.maxFileSize)+"</div>").appendTo(l.errorLog)}continue}if(R.maxFileCount!=-1&&l.selectedFiles>=R.maxFileCount){if(R.showError){b("<div style='color:red;'><b>"+c[y].name+"</b> "+R.maxFileCountErrorStr+R.maxFileCount+"</div>").appendTo(l.errorLog)}continue}l.selectedFiles++;var S=R;var g=new FormData;var Q=R.fileName.replace("[]","");g.append(Q,c[y]);var O=R.formData;if(O){var L=H(O);for(var K=0;K<L.length;K++){if(L[K]){g.append(L[K][0],L[K][1])}}}S.fileData=g;var M=new E(l,R);var P="";if(R.showFileCounter){P=l.fileCounter+R.fileCounterStyle+c[y].name}else{P=c[y].name}M.filename.html(P);var p=b("<form style='display:block; position:absolute;left: 150px;' class='"+l.formGroup+"' method='"+R.method+"' action='"+R.url+"' enctype='"+R.enctype+"'></form>");p.appendTo("body");var N=[];N.push(c[y].name);e(p,S,M,N,l,c[y]);l.fileCounter++}}function w(g,d,h){var f=d.allowedTypes.toLowerCase().split(",");var c=h.split(".").pop().toLowerCase();if(d.allowedTypes!="*"&&jQuery.inArray(c,f)<0){return false}return true}function G(d,c){if(d){c.show();var f=new FileReader;f.onload=function(g){c.attr("src",g.target.result)};f.readAsDataURL(d)}}function j(c,f){if(c.showFileCounter){var d=b(".ajax-file-upload-filename").length;f.fileCounter=d+1;b(".ajax-file-upload-filename").each(function(p,h){var l=b(this).html().split(c.fileCounterStyle);var m=parseInt(l[0])-1;var g=d+c.fileCounterStyle+l[1];b(this).html(g);d--})}}function A(v,l,g,h){var p="ajax-upload-id-"+(new Date).getTime();var d=b("<form method='"+g.method+"' action='"+g.url+"' enctype='"+g.enctype+"'></form>");var c="<input type='file' id='"+p+"' name='"+g.fileName+"' accept='"+g.acceptFiles+"'/>";if(g.multiple){if(g.fileName.indexOf("[]")!=g.fileName.length-2){g.fileName+="[]"}c="<input type='file' id='"+p+"' name='"+g.fileName+"' accept='"+g.acceptFiles+"' multiple/>"}var m=b(c).appendTo(d);m.change(function(){v.errorLog.html("");var K=g.allowedTypes.toLowerCase().split(",");var s=[];if(this.files){for(i=0;i<this.files.length;i++){s.push(this.files[i].name)}if(g.onSelect(this.files)==false){return}}else{var u=b(this).val();var r=[];s.push(u);if(!w(v,g,u)){if(g.showError){b("<div style='color:red;'><b>"+u+"</b> "+g.extErrorStr+g.allowedTypes+"</div>").appendTo(v.errorLog)}return}r.push({name:u,size:"NA"});if(g.onSelect(r)==false){return}}j(g,v);h.unbind("click");d.hide();A(v,l,g,h);d.addClass(l);if(a.fileapi&&a.formdata){d.removeClass(l);var L=this.files;D(g,v,L)}else{var y="";for(var i=0;i<s.length;i++){if(g.showFileCounter){y+=v.fileCounter+g.fileCounterStyle+s[i]+"<br>"}else{y+=s[i]+"<br>"}v.fileCounter++}if(g.maxFileCount!=-1&&v.selectedFiles+s.length>g.maxFileCount){if(g.showError){b("<div style='color:red;'><b>"+y+"</b> "+g.maxFileCountErrorStr+g.maxFileCount+"</div>").appendTo(v.errorLog)}return}v.selectedFiles+=s.length;var n=new E(v,g);n.filename.html(y);e(d,g,n,s,v,null)}});if(g.nestedForms){d.css({margin:0,padding:0});h.css({position:"relative",overflow:"hidden",cursor:"default"});m.css({position:"absolute",cursor:"pointer",top:"0px",width:"100%",height:"100%",left:"0px","z-index":"100",opacity:"0.0",filter:"alpha(opacity=0)","-ms-filter":"alpha(opacity=0)","-khtml-opacity":"0.0","-moz-opacity":"0.0"});d.appendTo(h)}else{d.appendTo(b("body"));d.css({margin:0,padding:0,display:"block",position:"absolute",left:"-250px"});if(navigator.appVersion.indexOf("MSIE ")!=-1){h.attr("for",p)}else{h.click(function(){m.click()})}}}function E(c,d){this.statusbar=b("<div class='ajax-file-upload-statusbar'></div>").width(d.statusBarWidth);this.preview=b("<img class='ajax-file-upload-preview'></img>").width(d.previewWidth).height(d.previewHeight).appendTo(this.statusbar).hide();this.filename=b("<div class='ajax-file-upload-filename'></div>").appendTo(this.statusbar);this.progressDiv=b("<div class='ajax-file-upload-progress'>").appendTo(this.statusbar).hide();this.progressbar=b("<div class='ajax-file-upload-bar "+c.formGroup+"'></div>").appendTo(this.progressDiv);this.abort=b("<div class='ajax-file-upload-red ajax-file-upload-abort "+c.formGroup+"'>"+d.abortStr+"</div>").appendTo(this.statusbar).hide();this.cancel=b("<div class='ajax-file-upload-red ajax-file-upload-cancel "+c.formGroup+"'>"+d.cancelStr+"</div>").appendTo(this.statusbar).hide();this.done=b("<div class='ajax-file-upload-green'>"+d.doneStr+"</div>").appendTo(this.statusbar).hide();this.download=b("<div class='ajax-file-upload-green'>"+d.downloadStr+"</div>").appendTo(this.statusbar).hide();this.del=b("<div class='ajax-file-upload-red'>"+d.deletelStr+"</div>").appendTo(this.statusbar).hide();if(d.showQueueDiv){b("#"+d.showQueueDiv).append(this.statusbar)}else{c.errorLog.after(this.statusbar)}return this}function e(y,m,g,h,v,d){var p=null;var c={cache:false,contentType:false,processData:false,forceSync:false,type:m.method,data:m.formData,formData:m.fileData,dataType:m.returnType,beforeSubmit:function(K,o,n){if(m.onSubmit.call(this,h)!=false){var s=m.dynamicFormData();if(s){var i=H(s);if(i){for(var r=0;r<i.length;r++){if(i[r]){if(m.fileData!=undefined){n.formData.append(i[r][0],i[r][1])}else{n.data[i[r][0]]=i[r][1]}}}}}v.tCounter+=h.length;J();return true}g.statusbar.append("<div style='color:red;'>"+m.uploadErrorStr+"</div>");g.cancel.show();y.remove();g.cancel.click(function(){g.statusbar.remove();m.onCancel.call(v,h,g);v.selectedFiles-=h.length;j(m,v)});return false},beforeSend:function(f,i){g.progressDiv.show();g.cancel.hide();g.done.hide();if(m.showAbort){g.abort.show();g.abort.click(function(){f.abort();v.selectedFiles-=h.length})}if(!a.formdata){g.progressbar.width("5%")}else{g.progressbar.width("1%")}},uploadProgress:function(l,f,u,i){if(i>98){i=98}var r=i+"%";if(i>1){g.progressbar.width(r)}if(m.showProgress){g.progressbar.html(r);g.progressbar.css("text-align","center")}},success:function(n,l,i){if(m.returnType=="json"&&b.type(n)=="object"&&n.hasOwnProperty(m.customErrorKeyStr)){g.abort.hide();var o=n[m.customErrorKeyStr];m.onError.call(this,h,200,o,g);if(m.showStatusAfterError){g.progressDiv.hide();g.statusbar.append("<span style='color:red;'>ERROR: "+o+"</span>")}else{g.statusbar.hide();g.statusbar.remove()}v.selectedFiles-=h.length;y.remove();v.fCounter+=h.length;return}v.responses.push(n);g.progressbar.width("100%");if(m.showProgress){g.progressbar.html("100%");g.progressbar.css("text-align","center")}g.abort.hide();m.onSuccess.call(this,h,n,i,g);if(m.showStatusAfterSuccess){if(m.showDone){g.done.show();g.done.click(function(){g.statusbar.hide("slow");g.statusbar.remove()})}else{g.done.hide()}if(m.showDelete){g.del.show();g.del.click(function(){g.statusbar.hide().remove();if(m.deleteCallback){m.deleteCallback.call(this,n,g)}v.selectedFiles-=h.length;j(m,v)})}else{g.del.hide()}}else{g.statusbar.hide("slow");g.statusbar.remove()}if(m.showDownload){g.download.show();g.download.click(function(){if(m.downloadCallback){m.downloadCallback(n)}})}y.remove();v.sCounter+=h.length},error:function(l,i,f){g.abort.hide();if(l.statusText=="abort"){g.statusbar.hide("slow").remove();j(m,v)}else{m.onError.call(this,h,i,f,g);if(m.showStatusAfterError){g.progressDiv.hide();g.statusbar.append("<span style='color:red;'>ERROR: "+f+"</span>")}else{g.statusbar.hide();g.statusbar.remove()}v.selectedFiles-=h.length}y.remove();v.fCounter+=h.length}};if(m.showPreview&&d!=null){if(d.type.toLowerCase().split("/").shift()=="image"){G(d,g.preview)}}if(m.autoSubmit){y.ajaxSubmit(c)}else{if(m.showCancel){g.cancel.show();g.cancel.click(function(){y.remove();g.statusbar.remove();m.onCancel.call(v,h,g);v.selectedFiles-=h.length;j(m,v)})}y.ajaxForm(c)}}var t=b.extend({url:"",method:"POST",enctype:"multipart/form-data",formData:null,returnType:null,allowedTypes:"*",acceptFiles:"*",fileName:"file",formData:{},dynamicFormData:function(){return{}},maxFileSize:-1,maxFileCount:-1,multiple:true,dragDrop:true,autoSubmit:true,showCancel:true,showAbort:true,showDone:true,showDelete:false,showError:true,showStatusAfterSuccess:true,showStatusAfterError:true,showFileCounter:true,fileCounterStyle:"). ",showProgress:false,nestedForms:true,showDownload:false,onLoad:function(c){},onSelect:function(c){return true},onSubmit:function(d,c){},onSuccess:function(f,c,g,d){},onError:function(f,c,g,d){},onCancel:function(d,c){},downloadCallback:false,deleteCallback:false,afterUploadAll:false,uploadButtonClass:"ajax-file-upload",dragDropStr:"<span><b>Drag & Drop Files</b></span>",abortStr:"Abort",cancelStr:"Cancel",deletelStr:"Delete",doneStr:"Done",multiDragErrorStr:"Multiple File Drag & Drop is not allowed.",extErrorStr:"is not allowed. Allowed extensions: ",sizeErrorStr:"is not allowed. Allowed Max size: ",uploadErrorStr:"Upload is not allowed",maxFileCountErrorStr:" is not allowed. Maximum allowed files are:",downloadStr:"Download",customErrorKeyStr:"jquery-upload-file-error",showQueueDiv:false,statusBarWidth:500,dragdropWidth:500,showPreview:false,previewHeight:"auto",previewWidth:"100%"},z);this.fileCounter=1;this.selectedFiles=0;this.fCounter=0;this.sCounter=0;this.tCounter=0;var C="ajax-file-upload-"+(new Date).getTime();this.formGroup=C;this.hide();this.errorLog=b("<div></div>");this.after(this.errorLog);this.responses=[];if(!a.formdata){t.dragDrop=false}if(!a.formdata){t.multiple=false}var q=this;var x=b("<div>"+b(this).html()+"</div>");b(x).addClass(t.uploadButtonClass);(function I(){if(b.fn.ajaxForm){if(t.dragDrop){var c=b('<div class="ajax-upload-dragdrop" style="vertical-align:top;"></div>').width(t.dragdropWidth);b(q).before(c);b(c).append(x);b(c).append(b(t.dragDropStr));F(q,t,c)}else{b(q).before(x)}t.onLoad.call(this,q);A(q,C,t,x)}else{window.setTimeout(I,10)}})();this.startUpload=function(){b("."+this.formGroup).each(function(c,d){if(b(this).is("form")){b(this).submit()}})};this.getFileCount=function(){return q.selectedFiles};this.stopUpload=function(){b(".ajax-file-upload-abort").each(function(c,d){if(b(this).hasClass(q.formGroup)){b(this).click()}})};this.cancelAll=function(){b(".ajax-file-upload-cancel").each(function(c,d){if(b(this).hasClass(q.formGroup)){b(this).click()}})};this.update=function(c){t=b.extend(t,c)};this.createProgress=function(d){var c=new E(this,t);c.progressDiv.show();c.progressbar.width("100%");c.filename.html(q.fileCounter+t.fileCounterStyle+d);q.fileCounter++;q.selectedFiles++;if(t.showDownload){c.download.show();c.download.click(function(){if(t.downloadCallback){t.downloadCallback.call(q,[d])}})}c.del.show();c.del.click(function(){c.statusbar.hide().remove();var f=[d];if(t.deleteCallback){t.deleteCallback.call(this,f,c)}q.selectedFiles-=1;j(t,q)})};this.getResponses=function(){return this.responses};var k=false;return this}})(jQuery);